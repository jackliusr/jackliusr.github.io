---
title: "recover from mysql XA transaction issues"
date: 2022-06-21T10:01:10+08:00
categories:
- tech
tags:
- mysql
- xa
---

In the past 2-3 weeks, I encountered an issue that I couldn't add a column to a table in one of our production database. I thought restart would resolve the issue. After a restart, however the issue still persist. I checked logs in error/mysql-error-running.log and noticed there are two transactions in prepared state after recovery. In the first gooogle search result page, https://www.percona.com/blog/2017/09/22/how-to-deal-with-xa-transactions-recovery/[How to Deal with XA Transactions Recovery] caught my attention. From there, I learnt xa transactions and figure out how to resolve my issue. 


With hindsight, I should notice that transactions in the result of "SHOW ENGINE INNODB STATUS". and sought solutions.

[source,sql]
----
-- no suspicious process here
SHOW FULL PROCESSLIST

-- the current transaction list 
-- don't find any transactions
SELECT * FROM information_schema.innodb_trx

-- two transactions
SHOW ENGINE INNODB STATUS

-- show the xa transactions
xa recover;
----

Reference: 
* https://mariadb.com/kb/en/xa-transactions/ [XA Transactions]
* https://www.percona.com/blog/2017/09/22/how-to-deal-with-xa-transactions-recovery/[How to Deal with XA Transactions Recovery]